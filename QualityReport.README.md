# Quality Report Workflow

This workflow generates a comprehensive quality control report for amplicon sequencing data using R-based analysis and visualization.

## Overview

The Quality Report workflow takes coverage and amplicon information files generated from previous pipeline steps and creates detailed quality control visualizations and summaries. This workflow is typically used as part of the larger MAD4HatTeR pipeline to assess data quality and provide insights into sequencing performance.

## Inputs

| Input Name | Description | Type | Required | Default |
|------------|-------------|------|----------|---------|
| **amplicon_coverage** | Mad4Hatter amplicon coverage file containing coverage statistics for each amplicon | File | Yes | N/A |
| **sample_coverage** | Mad4Hatter sample coverage file containing coverage statistics for each sample | File | Yes | N/A |
| **amplicon_info** | Mad4Hatter amplicon info file containing metadata about amplicons | File | Yes | N/A |
| **docker_image** | Docker image to use for creating the quality control report | String | No | eppicenter/mad4hatter:develop |

## Outputs

| Output Name | Description | Type |
|-------------|-------------|------|
| **quality_report_tar_gz** | Compressed archive containing the complete quality control report with visualizations and summaries | File |

## Workflow Description

The workflow consists of a single task that:

1. **Executes R Analysis**: Runs an R script (`cutadapt_summaryplots.R`) to process the input coverage files and generate quality control visualizations
2. **Creates Report Directory**: Organizes all generated outputs into a structured `quality_report` directory
3. **Compresses Results**: Packages the entire report directory into a compressed tar.gz archive for easy distribution

## Usage

### Basic Usage
```bash
# Example using Cromwell
java -jar cromwell.jar run quality_report.wdl --inputs quality_report_inputs.json
```

### Example Input JSON
```json
{
  "quality_report.amplicon_coverage": "path/to/amplicon_coverage.tsv",
  "quality_report.sample_coverage": "path/to/sample_coverage.tsv", 
  "quality_report.amplicon_info": "path/to/amplicon_info.tsv"
}
```

### Advanced Usage with Custom Docker Image
```json
{
  "quality_report.amplicon_coverage": "path/to/amplicon_coverage.tsv",
  "quality_report.sample_coverage": "path/to/sample_coverage.tsv",
  "quality_report.amplicon_info": "path/to/amplicon_info.tsv",
  "quality_report.docker_image": "custom/mad4hatter:v2.0"
}
```

## Technical Details

### Task: create_quality_report

- **Runtime**: Uses the specified Docker image (default: `eppicenter/mad4hatter:develop`)
- **R Script**: Executes `cutadapt_summaryplots.R` from Google Cloud Storage
- **Input Processing**: Takes three coverage/info files as arguments to the R script
- **Output Generation**: Creates a `quality_report` directory with all analysis results
- **Compression**: Packages results into `quality_report.tar.gz`

### R Script Location
The workflow uses a pre-configured R script located at:
```
gs://fc-a51e78f3-024d-415f-848e-aa7046173b53/scripts/cutadapt_summaryplots.R
```

## Integration with MAD4HatTeR Pipeline

This workflow is designed to work seamlessly with other MAD4HatTeR components:

- **Input Files**: Expects coverage files generated by the quality control workflow
- **Amplicon Info**: Uses amplicon metadata from the main pipeline configuration
- **Docker Image**: Compatible with the standard MAD4HatTeR Docker image

## Requirements

- WDL-compatible execution engine (Cromwell, Terra, etc.)
- Docker runtime
- Access to Google Cloud Storage for R script retrieval
- Input files in the expected MAD4HatTeR format

## Output Structure

The generated `quality_report.tar.gz` archive contains:
- Quality control visualizations (plots, charts)
- Coverage summaries and statistics
- Sample and amplicon performance metrics
- HTML reports and documentation

## Support

For questions or issues with the Quality Report workflow, please refer to the main MAD4HatTeR documentation or contact the development team.
